<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="daapr">
<title>A minimalist example deployed locally • daapr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="A minimalist example deployed locally">
<meta property="og:description" content="daapr">
<meta property="og:image" content="https://amashadihossein.github.io/daapr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">daapr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/daapr.html">Get started</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/min_wrkfl.html">A minimalist example</a>
    <a class="dropdown-item" href="../articles/input_data_update.html">Update input data</a>
    <a class="dropdown-item" href="../articles/dp_update.html">Update build logic</a>
    <a class="dropdown-item" href="../articles/min_workflow_local.html">A minimalist example deployed locally</a>
    <a class="dropdown-item" href="../articles/dp_merge.html">Combine two data products</a>
    <a class="dropdown-item" href="../articles/faq.html">Frequently Asked Questions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/amashadihossein/daapr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>A minimalist example deployed locally</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/amashadihossein/daapr/blob/HEAD/vignettes/min_workflow_local.Rmd" class="external-link"><code>vignettes/min_workflow_local.Rmd</code></a></small>
      <div class="d-none name"><code>min_workflow_local.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="goal">Goal:<a class="anchor" aria-label="anchor" href="#goal"></a>
</h2>
<p>Build, deploy and access a(n overly) simple data product locally to
get familiarized with the concepts and functions. This method is
applicable for building data products on locally or on mounted
drives.</p>
</div>
<div class="section level2">
<h2 id="user-story">User story<a class="anchor" aria-label="anchor" href="#user-story"></a>
</h2>
<p>We are interested in a data product that simply provides distances in
cars dataset in metric unit. See <code><a href="https://rdrr.io/r/datasets/cars.html" class="external-link">?cars</a></code> for additional
detail about the dataset.</p>
</div>
<div class="section level2">
<h2 id="step-1-initialize-the-project">Step 1: Initialize the project<a class="anchor" aria-label="anchor" href="#step-1-initialize-the-project"></a>
</h2>
<p>As this is a new project, we initialize the project using
<code><a href="https://rdrr.io/pkg/dpbuild/man/dp_init.html" class="external-link">dpbuild::dp_init</a></code>. See the getting started <a href="https://amashadihossein.github.io/daapr/articles/daapr.html">vignette</a>
for details of what the initialization does.</p>
<p>Note: when providing board params to
<code>board_params_set_local</code>, make sure to specify an absolute
path for “folder”, NOT a path relative to your current path.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">daapr</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Dry function call to set board location and name</span></span>
<span><span class="va">board_params_set_dried</span> <span class="op">&lt;-</span> <span class="fu">fn_dry</span><span class="op">(</span><span class="fu">board_params_set_local</span><span class="op">(</span></span>
<span>  folder <span class="op">=</span> <span class="st">"&lt;FOLDER_PATH&gt;"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initialize dp repo</span></span>
<span><span class="va">dp_repo</span> <span class="op">&lt;-</span> <span class="fu">dp_init</span><span class="op">(</span></span>
<span>  project_path <span class="op">=</span> <span class="st">"dp_cars"</span>,</span>
<span>  project_description <span class="op">=</span> <span class="st">"Cars data product"</span>,</span>
<span>  branch_name <span class="op">=</span> <span class="st">"us001"</span>,</span>
<span>  branch_description <span class="op">=</span> <span class="st">"User story 1"</span>,</span>
<span>  readme_general_note <span class="op">=</span> <span class="st">"Data product to explore cars stopping distance"</span>,</span>
<span>  board_params_set_dried <span class="op">=</span> <span class="va">board_params_set_dried</span>,</span>
<span>  github_repo_url <span class="op">=</span> <span class="st">"&lt;GIT PATH/dp_cars.git&gt;"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-2-set-up-the-working-environment">Step 2: Set up the working environment<a class="anchor" aria-label="anchor" href="#step-2-set-up-the-working-environment"></a>
</h2>
<p>At this point your project has all the basic components to provide
you with a sandbox where you can do your development. It is not
necessary, but it may be instructional to clean and restart your R
session before this next step. Then, activate and set up the sandbox for
this project.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Switch to project directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="va">dp_repo</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># only necessary if you re-started your R session</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="st">"daapr"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/zpackages.html" class="external-link">.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"daapr"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Set up env variables for remote code repository</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span><span class="st">"GITHUB_PAT"</span> <span class="op">=</span> <span class="st">"&lt;YOUR GITHUB PAT&gt;"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Retrieve configuration</span></span>
<span><span class="va">config</span> <span class="op">&lt;-</span> <span class="fu">dpconf_get</span><span class="op">(</span>project_path <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-3-add-input-data-and-sync-to-remote">Step 3: Add input data and sync to remote<a class="anchor" aria-label="anchor" href="#step-3-add-input-data-and-sync-to-remote"></a>
</h2>
<p>In this step you go from whatever content you have in the
<code>input_files</code> folder to metadata representation of the read
datasets. Here we only have one dataset: <code>cars.csv</code></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Upload data into input_files folder</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cars</span>, file <span class="op">=</span> <span class="st">"./input_files/cars.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Map all input_files content and optionally clean file labels in the map</span></span>
<span><span class="va">input_map</span> <span class="op">&lt;-</span> <span class="fu">dpinput_map</span><span class="op">(</span>project_path <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="va">input_map</span> <span class="op">&lt;-</span> <span class="fu">inputmap_clean</span><span class="op">(</span>input_map <span class="op">=</span> <span class="va">input_map</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Sync each read files to remote data repo</span></span>
<span><span class="va">synced_map</span> <span class="op">&lt;-</span> <span class="fu">dpinput_sync</span><span class="op">(</span>conf <span class="op">=</span> <span class="va">config</span>, input_map <span class="op">=</span> <span class="va">input_map</span>, verbose <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For each sync'd dataset, record info that will help you retrieve as needed</span></span>
<span><span class="fu">dpinput_write</span><span class="op">(</span>project_path <span class="op">=</span> <span class="st">"."</span>, input_d <span class="op">=</span> <span class="va">synced_map</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-4-build-the-data-product">Step 4: Build the data product<a class="anchor" aria-label="anchor" href="#step-4-build-the-data-product"></a>
</h2>
<p>Here is where the main logic of the data product is implement and the
data product is built.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read in the input data from what is recorded by dpinput_write</span></span>
<span><span class="va">data_files_read</span> <span class="op">&lt;-</span> <span class="fu">dpinput_read</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># build your output data</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="va">data_files_read</span><span class="op">$</span><span class="fu">cars</span><span class="op">(</span>config <span class="op">=</span> <span class="va">config</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dist_m <span class="op">=</span> <span class="fl">0.3048</span> <span class="op">*</span> <span class="va">dist</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Structure the input, output, metadata ... you wish to have in your data product</span></span>
<span><span class="va">data_object</span> <span class="op">&lt;-</span> <span class="fu">dp_structure</span><span class="op">(</span></span>
<span>  data_files_read <span class="op">=</span> <span class="va">data_files_read</span>,</span>
<span>  output <span class="op">=</span> <span class="va">output</span>, config <span class="op">=</span> <span class="va">config</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># save and log the data product built</span></span>
<span><span class="fu">dp_write</span><span class="op">(</span>data_object <span class="op">=</span> <span class="va">data_object</span>, project_path <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span></code></pre></div>
<p>Why so many steps if the above chunk is the main logic? The pay off
for all you have done is this: you have built a portable recipe where
your metadata, package dependencies, data and logic are all code! Now,
by simply saving the above chunk as an R-script, let’s say named
<code>dp_make.R</code>, you can have it reproduced from all the
configurations recorded without having to provide input data. Everything
now is code and can be tracked by <code>git</code>.</p>
<p>So to make your project reproducible save the above chunk as
<code>dp_make.R</code> in the main directory. Sourcing this file after
closing should be all that is needed to reproduce the data product.</p>
</div>
<div class="section level2">
<h2 id="step-5-commit-and-push">Step 5: Commit and push<a class="anchor" aria-label="anchor" href="#step-5-commit-and-push"></a>
</h2>
<p>At this point, you can commit and push your code. NOTE: for your push
to work:</p>
<ol style="list-style-type: decimal">
<li>You should have created the empty repo on the git remote
(e.g. github)</li>
<li>
<code>Sys.getenv("GITHUB_PAT")</code> returns the corresponding
“GITHUB_PAT”</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dp_commit</span><span class="op">(</span>project_path <span class="op">=</span> <span class="st">"."</span>, commit_description <span class="op">=</span> <span class="st">"First dp build"</span><span class="op">)</span></span>
<span><span class="fu">dp_push</span><span class="op">(</span>project_path <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-6-deploy">Step 6: Deploy<a class="anchor" aria-label="anchor" href="#step-6-deploy"></a>
</h2>
<p>Deploy the data product to the specified location:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Deploy data product to local board</span></span>
<span><span class="fu">dp_deploy</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-7-data-access">Step 7: Data access<a class="anchor" aria-label="anchor" href="#step-7-data-access"></a>
</h2>
<p>Typical access pattern starts with setting up the env vars, but for
brevity here we can just use the existing config to connect to the
board, get the data and list what else is on the board.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">board_object</span> <span class="op">&lt;-</span> <span class="fu">dp_connect</span><span class="op">(</span>board_params <span class="op">=</span> <span class="va">config</span><span class="op">$</span><span class="va">board_params</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dp</span> <span class="op">&lt;-</span> <span class="fu">dp_get</span><span class="op">(</span>board_object <span class="op">=</span> <span class="va">board_object</span>, data_name <span class="op">=</span> <span class="st">"dp-cars-us001"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dp_list</span><span class="op">(</span>board_object <span class="op">=</span> <span class="va">board_object</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Afshin Mashadi-Hossein, Clara Amorosi.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
