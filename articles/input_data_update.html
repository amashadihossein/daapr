<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="daapr">
<title>Update input data • daapr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Update input data">
<meta property="og:description" content="daapr">
<meta property="og:image" content="https://amashadihossein.github.io/daapr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">daapr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9005</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/daapr.html">Get started</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/min_wrkfl.html">A minimalist example</a>
    <a class="dropdown-item" href="../articles/input_data_update.html">Update input data</a>
    <a class="dropdown-item" href="../articles/dp_update.html">Update build logic</a>
    <a class="dropdown-item" href="../articles/dp_merge.html">Combine two data products</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/amashadihossein/daapr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Update input data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/amashadihossein/daapr/blob/HEAD/vignettes/input_data_update.Rmd" class="external-link"><code>vignettes/input_data_update.Rmd</code></a></small>
      <div class="d-none name"><code>input_data_update.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="goal">Goal:<a class="anchor" aria-label="anchor" href="#goal"></a>
</h2>
<p>Update <code>input_data</code> content of a data product</p>
</div>
<div class="section level2">
<h2 id="user-story">User story<a class="anchor" aria-label="anchor" href="#user-story"></a>
</h2>
<p>We would like to update the cars data product built in the <a href="https://amashadihossein.github.io/daapr/articles/min_wrkfl.html">minimalist
example</a> , excluding the last 5 rows as we have learned of issues
with those records.</p>
</div>
<div class="section level2">
<h2 id="step-1-navigate-to-dp_cars-project">Step 1: Navigate to <code>dp_cars</code> project<a class="anchor" aria-label="anchor" href="#step-1-navigate-to-dp_cars-project"></a>
</h2>
<p>NOTE: If you don’t have this project, you can clone it using
<code><a href="https://rdrr.io/pkg/dpbuild/man/dp_clone.html" class="external-link">dpbuild::dp_clone()</a></code>, and add folder
<code>input_files</code> to the top directory as the location for
depositing data.</p>
</div>
<div class="section level2">
<h2 id="step-2-set-the-working-environment">Step 2: Set the working environment<a class="anchor" aria-label="anchor" href="#step-2-set-the-working-environment"></a>
</h2>
<p>At this point, your project has all the basic components to provide
you with a sandbox where you can do your development. Re-activate and
restart the sandbox for the project.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Activate the repo and switch directory</span></span>
<span><span class="fu">dpbuild</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dpbuild/man/dp_activate.html" class="external-link">dp_activate</a></span><span class="op">(</span>project_path <span class="op">=</span> <span class="va">dp_repo</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># only necessary if you re-started your R session</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="st">"daapr"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/zpackages.html" class="external-link">.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"daapr"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up "promised" env variables for remote data repository</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span><span class="st">"AWS_KEY"</span> <span class="op">=</span> <span class="st">"&lt;BUCKETS AWS KEY&gt;"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span><span class="st">"AWS_SECRET"</span> <span class="op">=</span> <span class="st">"&lt;BUCKETS AWS SECRET&gt;"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up env variables for remote code repository</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span><span class="st">"GITHUB_PAT"</span> <span class="op">=</span> <span class="st">"&lt;YOUR GITHUB PAT&gt;"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Retrieve configuration</span></span>
<span><span class="va">config</span> <span class="op">&lt;-</span> <span class="fu">dpconf_get</span><span class="op">(</span>project_path <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-3-read-updated-input-data-sync-to-remote-and-record">Step 3: Read updated input data, sync to remote and record<a class="anchor" aria-label="anchor" href="#step-3-read-updated-input-data-sync-to-remote-and-record"></a>
</h2>
<p>In this step, you go from whatever content you have in the
<code>input_files</code> folder to metadata representation of the read
datasets. Given the goal to update the <code>cars.csv</code>, we
re-upload the corrected data first.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Upload data into input_files folder</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cars</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">45</span>,<span class="op">]</span>, file <span class="op">=</span> <span class="st">"./input_files/cars.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Map all input_files content and optionally clean file labels in the map</span></span>
<span><span class="va">input_map</span> <span class="op">&lt;-</span> <span class="fu">dpinput_map</span><span class="op">(</span>project_path <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span></code></pre></div>
<p>Examine <code>input_map</code>. Not only it contains the newly
uploaded data, it also brings along the last input_data from previous
records (i.e. the cars data with 50 rows). As our goal is to replace the
old <code>cars</code> table with the new one (i.e the one which only
contains the 1st 45 rows), we can remove the old record while cleaning
the names. In this case, the data to be removed has id “cars”.</p>
<p>NOTE: If you are not sure which one is the new and which one is the
old cars table, it may be instructive to inspect both datasets.
Remember, datasets already synced and read from the records are
accessible via anonymous function call that require <code>config</code>
parameters. Ex:
<code>input_map$input_obj$cars(config = config)</code></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_map</span> <span class="op">&lt;-</span> <span class="fu">inputmap_clean</span><span class="op">(</span>input_map <span class="op">=</span> <span class="va">input_map</span>, remove_id <span class="op">=</span> <span class="st">"cars"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Sync each read files to remote data repo</span></span>
<span><span class="va">synced_map</span> <span class="op">&lt;-</span> <span class="fu">dpinput_sync</span><span class="op">(</span>conf <span class="op">=</span> <span class="va">config</span>, input_map <span class="op">=</span> <span class="va">input_map</span>, verbose <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For each sync'd dataset, record info that will help you retrieve as needed</span></span>
<span><span class="fu">dpinput_write</span><span class="op">(</span>project_path <span class="op">=</span> <span class="st">"."</span>, input_d <span class="op">=</span> <span class="va">synced_map</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-4-build-the-data-product">Step 4: Build the data product<a class="anchor" aria-label="anchor" href="#step-4-build-the-data-product"></a>
</h2>
<p>Here is where the main logic of the data product is implemented and
the data product is built. For this step, we can simply re-run
<code>dp_make.R</code>, which will re-build the data product with
updated input data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"dp_make.R"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-5-commit-and-push">Step 5: Commit and push<a class="anchor" aria-label="anchor" href="#step-5-commit-and-push"></a>
</h2>
<p>At this point, you can commit and push your code.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dp_commit</span><span class="op">(</span>project_path <span class="op">=</span> <span class="st">"."</span>, </span>
<span>          commit_description <span class="op">=</span> <span class="st">"Updated input cars, dropping the last 5 rows"</span><span class="op">)</span></span>
<span><span class="fu">dp_push</span><span class="op">(</span>project_path <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Afshin Mashadi-Hossein.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
