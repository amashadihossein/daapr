<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>daapr: Combining two data products • daapr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="daapr: Combining two data products">
<meta property="og:description" content="daapr">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">daapr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9004</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/dp_merge.html">daapr: Combining two data products</a>
    </li>
    <li>
      <a href="../articles/dp_udpate.html">daapr: Updating build logic</a>
    </li>
    <li>
      <a href="../articles/input_data_update.html">daapr: Update input data</a>
    </li>
    <li>
      <a href="../articles/min_wrkfl.html">daapr: A minimalist example</a>
    </li>
    <li>
      <a href="../articles/typical_wrkfl.html">daapr: New project workflow</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/amashadihossein/daapr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="dp_merge_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>daapr: Combining two data products</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/amashadihossein/daapr/blob/master/vignettes/dp_merge.Rmd"><code>vignettes/dp_merge.Rmd</code></a></small>
      <div class="hidden name"><code>dp_merge.Rmd</code></div>

    </div>

    
    
<div id="goal" class="section level2">
<h2 class="hasAnchor">
<a href="#goal" class="anchor"></a>Goal</h2>
<p>Combine two data products to demonstrate the workflow</p>
</div>
<div id="background" class="section level2">
<h2 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h2>
<p>A data product with a broader scope may encompass one or more other data products. In such cases, data products can be directly imported within the data processing logic and they are not considered <code>input_data</code>.</p>
</div>
<div id="user-story" class="section level2">
<h2 class="hasAnchor">
<a href="#user-story" class="anchor"></a>User Story</h2>
<p>We need to have information we derived and encoded previously within <code>dp_cars-us001</code> and information within <code>dp_mtcars-us001</code> (which is simply a toy data product based on <code>mtcars</code> dataset we have built).</p>
</div>
<div id="step-1-initialize-the-project" class="section level2">
<h2 class="hasAnchor">
<a href="#step-1-initialize-the-project" class="anchor"></a>Step 1: Initialize the project</h2>
<p>As this is a new project, we initialize the project using <code><a href="https://rdrr.io/pkg/dpbuild/man/dp_init.html">dpbuild::dp_init</a></code>. See the vignette on new project workflow for details of what the initialization does.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">daapr</span><span class="op">)</span>

<span class="va">board_params_set_dried</span>  <span class="op">&lt;-</span> <span class="fu">fn_dry</span><span class="op">(</span><span class="fu">board_params_set_s3</span><span class="op">(</span>board_alias <span class="op">=</span> <span class="st">"&lt;ALIAS&gt;"</span>,
                                                      bucket_name <span class="op">=</span> <span class="st">"&lt;BUCKET&gt;"</span>,
                                                      region <span class="op">=</span> <span class="st">"&lt;REIGION&gt;"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Dry function call to setting credentials</span>
<span class="va">creds_set_dried</span> <span class="op">&lt;-</span> <span class="fu">fn_dry</span><span class="op">(</span><span class="fu">creds_set_aws</span><span class="op">(</span>key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">"AWS_KEY"</span><span class="op">)</span>,
                                        secret <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">"AWS_SECRET"</span><span class="op">)</span> <span class="op">)</span><span class="op">)</span>

<span class="co"># Initialize dp repo</span>
<span class="va">dp_repo</span> <span class="op">&lt;-</span> <span class="fu">dp_init</span><span class="op">(</span>project_path <span class="op">=</span> <span class="st">"dp_xcars"</span>,
                   project_description <span class="op">=</span> <span class="st">"Cars and mtcars combined data product"</span>,
                   branch_name <span class="op">=</span> <span class="st">"us001"</span>,
                   branch_description <span class="op">=</span> <span class="st">"User story 1"</span>,
                   readme_general_note <span class="op">=</span> <span class="st">"Data product combining cars and metcars"</span>,
                   board_params_set_dried <span class="op">=</span> <span class="va">board_params_set_dried</span>,
                   creds_set_dried <span class="op">=</span> <span class="va">creds_set_dried</span><span class="op">)</span></code></pre></div>
</div>
<div id="step-2-set-up-the-working-environment" class="section level2">
<h2 class="hasAnchor">
<a href="#step-2-set-up-the-working-environment" class="anchor"></a>Step 2: Set up the working environment</h2>
<p>At this point your project has all the basic components to provide you with a sandbox where you can do your development. It is not necessary, but it may be instructional to clean and restart your R session before this next step. Then, activate and set up the sandbox for this project.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># only necessary if you re-started your R session</span>
<span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="st">"daapr"</span> <span class="op">%in%</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/zpackages.html">.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"daapr"</span><span class="op">)</span>

<span class="co"># Activate the repo and switch directory</span>
<span class="fu">dp_activate</span><span class="op">(</span>project_path <span class="op">=</span> <span class="st">"./dp_xcars/"</span><span class="op">)</span>
<span class="fu">renv</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/renv/reference/restore.html">restore</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Set up "promised" env variables</span>
<span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span><span class="op">(</span><span class="st">"AWS_KEY"</span> <span class="op">=</span> <span class="st">"&lt;BUCKETS AWS KEY&gt;"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span><span class="op">(</span><span class="st">"AWS_SECRET"</span> <span class="op">=</span> <span class="st">"&lt;BUCKETS AWS SECRET&gt;"</span><span class="op">)</span>

<span class="co"># Retrieve configuration</span>
<span class="va">config</span> <span class="op">&lt;-</span> <span class="fu">dpconf_get</span><span class="op">(</span>project_path <span class="op">=</span> <span class="st">"."</span><span class="op">)</span>

<span class="co"># Set up remote git env variable so you can directly push your code to git </span>
<span class="co"># remote. This will only be used when you are pushing the code, but we can set </span>
<span class="co"># it now as we are setting up our working env. If you don't want to deal with</span>
<span class="co"># this you can skip this. You can still go quite far in the workflow</span>
<span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span><span class="op">(</span><span class="st">"GITHUB_PAT"</span> <span class="op">=</span> <span class="st">"&lt;YOUR GITHUB PAT&gt;"</span><span class="op">)</span></code></pre></div>
</div>
<div id="step-3-build-the-data-product" class="section level2">
<h2 class="hasAnchor">
<a href="#step-3-build-the-data-product" class="anchor"></a>Step 3: Build the data product</h2>
<p>Here is where the main logic of the data product is implement and the data product is built. Note, if we had additional data that needed to be included in the data product, we would mapped and synced it as done when building <code>dp_cars</code>, prior to build the <code>dp_xcars</code> logic.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">dp_connect</span><span class="op">(</span>board_params <span class="op">=</span> <span class="va">config</span><span class="op">$</span><span class="va">board_params</span>, creds <span class="op">=</span> <span class="va">config</span><span class="op">$</span><span class="va">creds</span><span class="op">)</span>

<span class="va">dp_cars</span> <span class="op">&lt;-</span> <span class="fu">dp_get</span><span class="op">(</span>board_params <span class="op">=</span> <span class="va">config</span><span class="op">$</span><span class="va">board_params</span>,
                  data_name <span class="op">=</span> <span class="st">"dp-cars-us001"</span><span class="op">)</span>

<span class="va">dp_mtcars</span> <span class="op">&lt;-</span> <span class="fu">dp_get</span><span class="op">(</span>board_params <span class="op">=</span> <span class="va">config</span><span class="op">$</span><span class="va">board_params</span>,
                  data_name <span class="op">=</span> <span class="st">"dp-mtcars-us001"</span><span class="op">)</span>

<span class="co"># build your output data</span>
<span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>cars <span class="op">=</span> <span class="va">dp_cars</span><span class="op">$</span><span class="va">input</span><span class="op">$</span><span class="va">cars</span>, mt_cars <span class="op">=</span> <span class="va">dp_mtcars</span><span class="op">$</span><span class="va">input</span><span class="op">$</span><span class="va">mtcars</span><span class="op">)</span>

<span class="co"># Structure the input, output, metadata ... you wish to have in your data product</span>
<span class="va">data_object</span> <span class="op">&lt;-</span> <span class="fu">dp_structure</span><span class="op">(</span>data_files_read <span class="op">=</span> <span class="cn">NULL</span>,
                            output <span class="op">=</span> <span class="va">output</span>,config <span class="op">=</span> <span class="va">config</span><span class="op">)</span>
<span class="co"># save and log the data product built</span>
<span class="fu">dp_write</span><span class="op">(</span>data_object <span class="op">=</span> <span class="va">data_object</span>, project_path <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></code></pre></div>
</div>
<div id="step-5-commit-and-push" class="section level2">
<h2 class="hasAnchor">
<a href="#step-5-commit-and-push" class="anchor"></a>Step 5: Commit and push</h2>
<p>At this point, you can commit and push your code. NOTE: for your push to work</p>
<ol style="list-style-type: decimal">
<li>You should have created the empty repo on the git remote (e.g. github)</li>
<li>
<code><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv("GITHUB_PAT")</a></code> returns the corresponding “GITHUB_PAT”</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">dp_commit</span><span class="op">(</span>project_path <span class="op">=</span> <span class="st">"."</span>, commit_description <span class="op">=</span> <span class="st">"First dp build"</span><span class="op">)</span>
<span class="fu">dp_push</span><span class="op">(</span>project_path <span class="op">=</span> <span class="st">"."</span>, remote_url <span class="op">=</span> <span class="st">"&lt;GIT PATH/dp_cars.git&gt;"</span> <span class="op">)</span></code></pre></div>
</div>
<div id="step-6-deploy" class="section level2">
<h2 class="hasAnchor">
<a href="#step-6-deploy" class="anchor"></a>Step 6: Deploy</h2>
<p>The typical deploy should follow a fresh clone from remote git (e.g. by CI), but here for brevity we can bypass that and manually deploy.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">dp_deploy</span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="step-7-data-access" class="section level2">
<h2 class="hasAnchor">
<a href="#step-7-data-access" class="anchor"></a>Step 7: Data access</h2>
<p>Typical access pattern starts with setting up the env vars, but for brevity here we can just use the existing config to connect to the board, get the data and list what else is on the board.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">dp_connect</span><span class="op">(</span>board_params <span class="op">=</span> <span class="va">config</span><span class="op">$</span><span class="va">board_params</span>, creds <span class="op">=</span> <span class="va">config</span><span class="op">$</span><span class="va">creds</span><span class="op">)</span>

<span class="va">dp</span> <span class="op">&lt;-</span> <span class="fu">dp_get</span><span class="op">(</span>board_params <span class="op">=</span> <span class="va">config</span><span class="op">$</span><span class="va">board_params</span>, data_name <span class="op">=</span> <span class="st">"dp-xcars-us001"</span><span class="op">)</span>

<span class="fu">dp_list</span><span class="op">(</span>board_params <span class="op">=</span> <span class="va">config</span><span class="op">$</span><span class="va">board_params</span><span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Afshin Mashadi-Hossein.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
